# 冷靜通道功能測試指南

## 🧪 測試前準備

### 1. 環境設置
- 確保 Firebase 專案已正確配置
- 更新 Firestore 安全規則
- 準備兩個測試帳號進行配對測試

### 2. 前置條件
- 兩個用戶都已註冊並登入
- 兩個用戶已成功配對
- 主界面可以正常顯示心情和回應功能

## 📱 功能測試流程

### 階段 1：入口與權限測試
1. **未配對狀態測試**
   - 使用未配對的帳號
   - 點擊「🌧️ 想開啟冷靜通道？」按鈕
   - 應顯示「尚未配對」的提示畫面

2. **已配對狀態測試**
   - 使用已配對的帳號
   - 點擊冷靜通道按鈕
   - 應進入冷靜通道介面並顯示警告提示

### 階段 2：聊天室啟用測試
1. **啟用冷靜通道**
   - 點擊「開始對話」按鈕
   - 檢查是否成功啟用聊天狀態
   - 介面應切換至聊天模式

2. **雙向同步測試**
   - 在另一個裝置上開啟相同配對的帳號
   - 檢查聊天室狀態是否自動同步
   - 兩邊都應顯示聊天已啟用

### 階段 3：訊息發送與接收測試
1. **基本訊息測試**
   - 發送純文字訊息
   - 檢查即時同步功能
   - 驗證訊息氣泡顯示正確

2. **訊息類型測試**
   - 測試所有 5 種訊息類型
   - 確認每種類型的 emoji 和描述正確
   - 檢查類型選擇器功能

3. **快速回應測試**
   - 使用快速回應按鈕發送
   - 測試道歉、擁抱、中性類型
   - 確認訊息正確發送和顯示

### 階段 4：特殊功能測試
1. **道歉訊息快速回覆**
   - 發送道歉類型訊息
   - 在接收端檢查是否顯示快速回覆按鈕
   - 測試「和好吧」和「等一下」按鈕
   - 確認回覆訊息正確發送

2. **訊息過期測試**
   - 創建測試訊息（可暫時調整過期時間為較短時間測試）
   - 檢查過期訊息是否被正確過濾
   - 驗證過期邏輯運作正常

### 階段 5：聊天室管理測試
1. **關閉通道測試**
   - 點擊「關閉通道」按鈕
   - 檢查聊天室是否停用
   - 確認無法再發送新訊息
   - 驗證雙方同步停用狀態

2. **重新啟用測試**
   - 再次點擊冷靜通道按鈕
   - 測試重新啟用功能
   - 檢查歷史訊息是否保留

## 🔍 UI/UX 測試重點

### 1. 視覺設計
- **背景色調**：確認冷靜的灰色漸層
- **警告橫幅**：橙色提示框顯示正確
- **訊息氣泡**：自己/對方的顏色區分清晰
- **圓角設計**：符合整體 App 風格

### 2. 互動體驗
- **按鈕回饋**：按壓效果流暢
- **輸入框**：支援多行文字輸入
- **滾動體驗**：自動滾動到最新訊息
- **鍵盤處理**：輸入時介面調整正常

### 3. 狀態提示
- **載入狀態**：顯示適當的載入指示器
- **錯誤處理**：網路錯誤時顯示清楚提示
- **空狀態**：無訊息時的提示友善

## 🛡️ 安全性測試

### 1. 權限驗證
- 嘗試訪問非自己配對的聊天室
- 檢查 Firestore 規則是否正確阻擋
- 驗證只有配對用戶能訪問

### 2. 資料完整性
- 檢查必要欄位是否都有設定
- 驗證訊息類型限制
- 確認過期時間設定正確

### 3. 異常情況處理
- 網路中斷時的行為
- 同時發送訊息的衝突處理
- 配對狀態變更時的處理

## 📊 效能測試

### 1. 回應速度
- 訊息發送到接收的延遲
- 介面切換的流暢度
- 大量訊息時的滾動效能

### 2. 記憶體使用
- 長時間使用的記憶體穩定性
- Listener 的正確釋放
- 圖片和 emoji 的記憶體管理

## ✅ 測試檢查清單

### 基本功能
- [ ] 冷靜通道入口顯示正確
- [ ] 未配對時拒絕訪問
- [ ] 已配對時可正常進入
- [ ] 警告提示顯示清楚
- [ ] 聊天室啟用/停用功能正常

### 訊息功能
- [ ] 文字訊息發送接收正常
- [ ] 5 種訊息類型都能正常使用
- [ ] 快速回應按鈕工作正常
- [ ] 道歉訊息快速回覆功能正常
- [ ] 訊息時間顯示正確

### 同步功能
- [ ] 雙方即時同步訊息
- [ ] 聊天室狀態同步
- [ ] 離線後重新上線同步正常

### UI/UX
- [ ] 介面設計符合需求
- [ ] 互動回饋流暢
- [ ] 錯誤提示友善
- [ ] 適配不同螢幕尺寸

### 安全性
- [ ] Firestore 規則保護有效
- [ ] 無法訪問他人聊天室
- [ ] 訊息資料完整性檢查

## 🐛 常見問題排除

### 1. 訊息不同步
- 檢查網路連線
- 確認 Firestore 規則正確
- 重新啟動 Listener

### 2. 介面顯示異常
- 檢查顏色資源檔案
- 確認字體和圖示載入
- 重新整理介面狀態

### 3. 權限錯誤
- 檢查用戶配對狀態
- 驗證 Firestore 規則設定
- 確認用戶認證狀態

---

**注意**：測試過程中如發現任何問題，請記錄具體的重現步驟和錯誤訊息，以便後續修復。 